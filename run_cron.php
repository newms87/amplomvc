<?php
define("RUN_CRON", true);
require_once dirname(__FILE__) . '/index.php';


//select UsersRef as Tech, 'RoofScope' as `Scope Type`, s.product_id, p.name as Product, COUNT(*) as Total, DATE_FORMAT(ScopeDate, '%Y-%m-%d') as Date FROM roofscope.Projects s LEFT JOIN caddash.ac_scope_products p ON (p.product_id = s.product_id) WHERE IsCurrent = 1 AND ScopeDate > DATE_SUB(NOW(), INTERVAL 2 MONTH) AND rowid > 45000 GROUP BY UsersRef, product_id, DATE_FORMAT(ScopeDate, '%Y-%m-%d') UNION select UsersRef as Tech, 'GutterScope' as `Scope Type`, s.product_id, p.name as Product, COUNT(*) as Total, DATE_FORMAT(ScopeDate, '%Y-%m-%d') as Date FROM gutterscope.Projects s LEFT JOIN caddash.ac_scope_products p ON (p.product_id = s.product_id) WHERE IsCurrent = 1 AND ScopeDate > DATE_SUB(NOW(), INTERVAL 2 MONTH) GROUP BY UsersRef, product_id, DATE_FORMAT(ScopeDate, '%Y-%m-%d') UNION select UsersRef as Tech, 'PaintScope' as `Scope Type`, s.product_id, p.name as Product, COUNT(*) as Total, DATE_FORMAT(ScopeDate,'%Y-%m-%d') as Date FROM paintlightscope.Projects s LEFT JOIN caddash.ac_scope_products p ON (p.product_id = s.product_id) WHERE IsCurrent = 1 AND ScopeDate > DATE_SUB(NOW(), INTERVAL 2 MONTH) GROUP BY UsersRef, product_id, DATE_FORMAT(ScopeDate, '%Y-%m-%d') UNION select UsersRef as Tech, 'PaintProScope' as `Scope Type`, s.product_id, p.name as Product, COUNT(*) as Total, DATE_FORMAT(ScopeDate,'%Y-%m-%d') as Date FROM paintproscope.Projects s LEFT JOIN caddash.ac_scope_products p ON (p.product_id = s.product_id) WHERE IsCurrent = 1 AND ScopeDate > DATE_SUB(NOW(), INTERVAL 2 MONTH) GROUP BY UsersRef, product_id, DATE_FORMAT(ScopeDate, '%Y-%m-%d') UNION select UsersRef as Tech, 'SidingScope' as `Scope Type`, s.product_id, p.name as Product, COUNT(*) as Total, DATE_FORMAT(ScopeDate,'%Y-%m-%d') as Date FROM sidingscope.Projects s LEFT JOIN caddash.ac_scope_products p ON (p.product_id = s.product_id) WHERE IsCurrent = 1 AND ScopeDate > DATE_SUB(NOW(), INTERVAL 2 MONTH) GROUP BY UsersRef, product_id, DATE_FORMAT(ScopeDate, '%Y-%m-%d') UNION select UsersRef as Tech, 'InsulationScope' as `Scope Type`, s.product_id, p.name as Product, COUNT(*) as Total, DATE_FORMAT(ScopeDate,'%Y-%m-%d') as Date FROM insulationscope.Projects s LEFT JOIN caddash.ac_scope_products p ON (p.product_id = s.product_id) WHERE IsCurrent = 1 AND ScopeDate > DATE_SUB(NOW(), INTERVAL 2 MONTH) GROUP BY UsersRef, product_id, DATE_FORMAT(ScopeDate, '%Y-%m-%d') UNION select UsersRef as Tech, 'ConcreteScope' as `Scope Type`, s.product_id, p.name as Product, COUNT(*) as Total, DATE_FORMAT(ScopeDate,'%Y-%m-%d') as Date FROM concretescope.Projects s LEFT JOIN caddash.ac_scope_products p ON (p.product_id = s.product_id) WHERE IsCurrent = 1 AND ScopeDate > DATE_SUB(NOW(), INTERVAL 2 MONTH) GROUP BY UsersRef, product_id, DATE_FORMAT(ScopeDate, '%Y-%m-%d') ORDER BY Date, Tech

"SELECT ";
